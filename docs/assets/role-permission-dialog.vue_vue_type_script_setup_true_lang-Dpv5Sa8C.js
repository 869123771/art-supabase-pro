var e=(e,l,a)=>new Promise((t,s)=>{var n=e=>{try{d(a.next(e))}catch(l){s(l)}},o=e=>{try{d(a.throw(e))}catch(l){s(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,o);d((a=a.apply(e,l)).next())});import{d as l,bi as a,a as t,c as s,w as n,y as o,f as d,z as u,H as i,p as r,aG as c,u as v,h as p,e as h,m as f,aT as y,l as m,G as k,bu as g,a_ as C,bv as _,bw as b}from"./index-D2YTfifR.js";import{E as x}from"./el-dialog-CKnhTw94.js";import"./el-overlay-CYBWNh-f.js";import{E as K}from"./el-button-BGDwCa_e.js";/* empty css                     *//* empty css                *//* empty css                    */import{E as j}from"./index-D1Jq2W1X.js";import{E as V}from"./index-CTQDs-Qt.js";const w={style:{display:"flex","align-items":"center"}},D={key:0},E={key:1},P=l({__name:"role-permission-dialog",props:{modelValue:{type:Boolean,default:!1},roleData:{default:void 0}},emits:["update:modelValue","success"],setup(l,{emit:P}){const T=l,H=P,R=new a({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),G=t(!1),I=t([]),L=t(),N=t(!0),U=t(!1),z=s({get:()=>T.modelValue,set:e=>H("update:modelValue",e)}),A=s(()=>{const e=L.value;if(e)return e.getCheckedKeys()}),B={children:"children",label:e=>{var l;return c(null==(l=e.meta)?void 0:l.title)||e.label||""}};n(()=>T.modelValue,l=>e(null,null,function*(){l&&T.roleData&&(yield F(),yield J())}));const M=()=>{var e;z.value=!1,null==(e=L.value)||e.setCheckedKeys([])},O=()=>e(null,null,function*(){var e;try{G.value=!0;const l=A.value,a={p_role_id:null==(e=T.roleData)?void 0:e.id,p_menu_ids:l},{error:t}=yield g(a);t||(H("success"),M())}finally{G.value=!1}}),S=()=>{const e=L.value;if(!e)return;const l=e.store.nodesMap;Object.values(l).forEach(e=>{e.expanded=!N.value}),N.value=!N.value},W=()=>{var e;const l=L.value;if(l){if(U.value)l.setCheckedKeys([]);else{const a=null==(e=R.treeToList(I.value,{includeDepth:!0,includeParentChain:!0}))?void 0:e.map(e=>e.id);l.setCheckedKeys(a)}U.value=!U.value}},$=()=>{var e;const l=A.value,a=null==(e=R.treeToList(I.value,{includeDepth:!0,includeParentChain:!0}))?void 0:e.map(e=>e.id);U.value=l.length===a.length&&a.length>0},q=()=>{const e=L.value;if(!e)return;e.getCheckedKeys(),e.getHalfCheckedKeys(),e.getCheckedNodes(),e.getHalfCheckedNodes();const l=e.getCheckedKeys().length;e.getHalfCheckedKeys().length;C.success(`已输出选中数据到控制台，共选中 ${l} 个节点`)},F=()=>e(null,null,function*(){try{G.value=!0;const{data:e}=yield _();I.value=R.listToTree(e)}finally{G.value=!1}}),J=()=>e(null,null,function*(){var e,l;try{G.value=!0;const a={id:null==(e=T.roleData)?void 0:e.id},{data:t}=yield b(a);if(t){const e=(t||[]).map(e=>e.menuId);null==(l=L.value)||l.setCheckedKeys(e)}}finally{G.value=!1}});return(e,l)=>{const a=V,t=j,s=K,n=x,c=y;return d(),o(n,{modelValue:v(z),"onUpdate:modelValue":l[0]||(l[0]=e=>k(z)?z.value=e:null),title:"菜单权限",width:"520px","align-center":"",class:"el-dialog-border",onClose:M},{footer:u(()=>[r(s,{onClick:q},{default:u(()=>[...l[1]||(l[1]=[m("获取选中数据",-1)])]),_:1}),r(s,{onClick:S},{default:u(()=>[m(f(v(N)?"全部收起":"全部展开"),1)]),_:1}),r(s,{onClick:W},{default:u(()=>[m(f(v(U)?"取消全选":"全部选择"),1)]),_:1}),r(s,{type:"primary",onClick:O,loading:v(G)},{default:u(()=>[...l[2]||(l[2]=[m("保存",-1)])]),_:1},8,["loading"])]),default:u(()=>[i((d(),o(t,{height:"70vh"},{default:u(()=>[r(a,{ref_key:"treeRef",ref:L,data:v(I),"show-checkbox":"","check-strictly":"","node-key":"id","default-expand-all":v(N),"default-checked-keys":[],props:B,onCheck:$},{default:u(({data:e})=>[p("div",w,[e.isAuth?(d(),h("span",D,f(e.label),1)):(d(),h("span",E,f(B.label(e)),1))])]),_:1},8,["data","default-expand-all"])]),_:1})),[[c,v(G)]])]),_:1},8,["modelValue"])}}});export{P as _};
