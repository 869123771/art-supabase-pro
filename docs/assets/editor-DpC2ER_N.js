const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CcGVUB6J.js","assets/index-DPSTeJg3.js","assets/index-7AIjqV-w.css"])))=>i.map(i=>d[i]);
var e=(e,t,a)=>new Promise((l,n)=>{var r=e=>{try{u(a.next(e))}catch(t){n(t)}},o=e=>{try{u(a.throw(e))}catch(t){n(t)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);u((a=a.apply(e,t)).next())});import{d as t,a3 as a,aF as l,w as n,aC as r,p as o,d_ as u,o as i,m as d,n as s,q as c,d$ as v,e0 as p,b as f,c as g,k as y,u as m,h,di as S,at as b}from"./index-DPSTeJg3.js";import{_ as w}from"./_plugin-vue_export-helper-BCo6x5W8.js";var O=Object.defineProperty,V=Object.defineProperties,M=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,x=(e,t,a)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,P=(e,t)=>{for(var a in t||(t={}))_.call(t,a)&&x(e,a,t[a]);if(L)for(var a of L(t))j.call(t,a)&&x(e,a,t[a]);return e};const k={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function R(e,t){return{wrapperStyle:o(()=>{const{width:t,height:a}=e;return l=P({},k.wrapper),V(l,M({width:t,height:a}));var l}),containerStyle:o(()=>P(P({},k.fullWidth),!t.value&&k.hide))}}function E(e){return"function"==typeof e?e():e}function I(e){return void 0===e}function C(e,t,a,l){return function(e,t){return e.editor.getModel(D(e,t))}(e,l)||function(e,t,a,l){return e.editor.createModel(t,a,l?D(e,l):void 0)}(e,t,a,l)}function D(e,t){return e.Uri.parse(t)}var K=Object.defineProperty,T=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,N=(e,t,a)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;const B={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var Q=t({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const a=new Map,c=r(null),{monacoRef:v,unload:p,isLoadFailed:f}=function(){const e=r(u.__getMonacoInstance()),t=d(!1);let a;return i(()=>{e.value||(a=u.init(),a.then(t=>e.value=t).catch(e=>{"cancelation"!==(null==e?void 0:e.type)&&(t.value=!0)}))}),{monacoRef:e,unload:()=>null==a?void 0:a.cancel(),isLoadFailed:t}}(),{editorRef:g}=function({emit:e},t,a,l){const o=r(null);function u(){var n;if(!l.value||!a.value||o.value)return;e("beforeMount",a.value);const r=t.path||t.defaultPath,u=C(a.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",r||"");o.value=a.value.editor.create(l.value,((e,t)=>{for(var a in t||(t={}))q.call(t,a)&&N(e,a,t[a]);if(T)for(var a of T(t))F.call(t,a)&&N(e,a,t[a]);return e})({model:u,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),null==(n=o.value)||n.onDidChangeModelContent(a=>{const l=o.value.getValue();l!==t.value&&(e("update:value",l),e("change",l,a))}),o.value&&!I(t.line)&&o.value.revealLine(t.line),e("mount",o.value,a.value)}return i(()=>{const e=n(a,()=>{l.value&&a.value&&(s(()=>e()),u())},{immediate:!0})}),{editorRef:o}}(t,e,v,c),{disposeValidator:y}=function({emit:e},t,a,l){const r=d(null),o=n([a,l],()=>{if(a.value&&l.value){s(()=>o());const t=a.value.editor.onDidChangeMarkers(t=>{var n,r;const o=null==(r=null==(n=l.value)?void 0:n.getModel())?void 0:r.uri;if(o){if(t.find(e=>e.path===o.path)){const t=a.value.editor.getModelMarkers({resource:o});e("validate",t)}}});r.value=()=>null==t?void 0:t.dispose()}});return{disposeValidator:r}}(t,0,v,g),m=o(()=>!!v.value&&!!g.value),{wrapperStyle:h,containerStyle:S}=R(e,m);return l(()=>{var e,t;null==(e=y.value)||e.call(y),g.value?(null==(t=g.value.getModel())||t.dispose(),g.value.dispose()):p()}),n([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([t,l,n,r],[o,u,i,d])=>{if(m.value){if(t!==o){const u=C(v.value,l||e.defaultValue||"",n||e.defaultLanguage||"",t||e.defaultPath||"");return e.saveViewState&&a.set(o,g.value.saveViewState()),g.value.setModel(u),e.saveViewState&&g.value.restoreViewState(a.get(t)),void(I(r)||g.value.revealLine(r))}g.value.getValue()!==l&&g.value.setValue(l),n!==i&&v.value.editor.setModelLanguage(g.value.getModel(),n),I(r)||r===d||g.value.revealLine(r)}}),n(()=>e.options,e=>g.value&&g.value.updateOptions(e),{deep:!0}),n(()=>e.theme,e=>v.value&&v.value.editor.setTheme(e)),{containerRef:c,isEditorReady:m,isLoadFailed:f,wrapperStyle:h,containerStyle:S}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:l,wrapperStyle:n,containerStyle:r,className:o}=this;return a("div",{style:n},[!t&&a("div",{style:B},l?e.failure?E(e.failure):"load failed":e.default?E(e.default):"loading..."),a("div",{ref:"containerRef",key:"monaco_editor_container",style:r,class:o})])}});const W={class:"editor-wrapper"},A={key:0,class:"editor-placeholder"},U=w(t({__name:"editor",props:{modelValue:{},language:{default:"pgsql"},readOnly:{type:Boolean,default:!1}},emits:["update:modelValue","execute"],setup(t,{expose:a,emit:l}){const n=t,r=l,u=c(),s=d(null);let w=null;const O=d({automaticLayout:!0,minimap:{enabled:!1},fontSize:13,border:!1,lineNumbers:"on",roundedSelection:!1,scrollBeyondLastLine:!1,readOnly:n.readOnly,fixedOverflowWidgets:!0,suggestOnTriggerCharacters:!0,quickSuggestions:!0,wordBasedSuggestions:!0}),V=o(()=>"dark"===u.systemThemeType?"vs-dark":"vs"),M=e=>{r("update:modelValue",e)},L=e=>{w=e,e.addAction({id:"run-query-action",label:"Run Query",keybindings:[2051],contextMenuGroupId:"1_modification",contextMenuOrder:2,run:()=>{j()}})},_=()=>{if(w){const e=w.getSelection(),t=w.getModel();if(e&&t&&!e.isEmpty())return t.getValueInRange(e)}return n.modelValue},j=()=>{const e=_();e.trim()?r("execute",e):S.warning("请输入 SQL 查询")},x=e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),j()),e.shiftKey&&"Enter"===e.key&&(e.preventDefault(),j()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key&&(e.preventDefault(),P())},P=()=>e(null,null,function*(){if(n.modelValue.trim())try{const{format:t}=yield b(()=>e(null,null,function*(){const{format:e}=yield import("./index-CcGVUB6J.js");return{format:e}}),__vite__mapDeps([0,1,2])),a=t(n.modelValue,{language:"postgresql",tabWidth:2,keywordCase:"upper",linesBetweenQueries:1});r("update:modelValue",a)}catch(t){S.error("SQL 格式化失败")}});return a({format:P,clear:()=>{r("update:modelValue","")},getSqlToExecute:_}),i(()=>e(null,null,function*(){try{const e=yield v();p(e)}catch(e){}})),(e,a)=>(f(),g("div",W,[y(m(Q),{ref_key:"editorRef",ref:s,wrapperStyle:{height:"100%"},value:t.modelValue,language:t.language,theme:V.value,options:O.value,"onUpdate:value":M,onKeydown:x,onMount:L},null,8,["value","language","theme","options"]),t.modelValue?h("",!0):(f(),g("div",A,"请输入Postgre SQL 进行查询"))]))}}),[["__scopeId","data-v-4d1ce200"]]);export{U as default};
