var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&o(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&o(e,l,t[l]);return e},s=(e,r)=>t(e,l(r)),p=(e,t,l)=>new Promise((r,a)=>{var i=e=>{try{n(l.next(e))}catch(t){a(t)}},o=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,t)).next())});import{d as u,e1 as m,o as d,dm as c,e2 as v,F as j,b as y,c as f,k as b,u as h,G as _,z as g,H as x,y as k,i as w,j as T,m as O,l as C,p as P,n as E,aG as R,a3 as S,e3 as D,e4 as B,di as I}from"./index-DHdgQId_.js";import{E as K}from"./el-card-DFmHUaKG.js";import{_ as U}from"./index-C2ZFKNRi.js";import{_ as V}from"./index-C2NT0vod.js";import{E as A}from"./el-button-0c2o2QLg.js";import{_ as Z}from"./index-Dkm5XP97.js";import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-Bd222Qnp.js";import{_ as L}from"./menu-dialog.vue_vue_type_script_setup_true_lang-Dq3an722.js";import{E as M}from"./overlay-Ds1eBgJc.js";/* empty css              */import"./tree-select-CPuxTqV_.js";import{b as N}from"./el-option-Ct8FZxN7.js";import"./el-empty-EjDuF44L.js";import"./index-Bc4hPq7U.js";import"./index-ci4gPeH2.js";import"./index-CJHBY14B.js";import"./event-BwRzfsZt.js";import"./focus-trap-CUkHjRSh.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./index-CDL13igh.js";import"./index-cfyCizLf.js";import"./_baseClone-Do42dbT3.js";import"./isArrayLikeObject-RE9YRrkx.js";import"./omit-Dn9XeOP_.js";import"./debounce-B272wxs9.js";import"./toNumber-CtH2CKpA.js";import"./index-99KMa0En.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css                   */import"./el-dropdown-item-bk8prIMw.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-BLNSALDk.js";import"./index-BgA9WuFL.js";import"./el-form-item-vI0w3RAk.js";import"./el-row-deoSVNxC.js";import"./el-col-DLpe40ZC.js";import"./el-radio-C4KzvC8M.js";import"./index-B5xS5dLt.js";import"./validator-BQ-PZgIx.js";import"./index--zanLudC.js";import"./el-dialog-CvbxKYde.js";import"./index-enXvaKOk.js";import"./vnode-B83KbSSl.js";import"./el-overlay-D6YYUai9.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-DEUhHID8.js";import"./isEmpty-B-SMALGS.js";import"./cloneDeep-BgGA_MGi.js";import"./index-BxgJu9aB.js";import"./index-DcM-YV4m.js";import"./index-Bsy5TWWF.js";const W={class:"menu-page art-full-height"},$=u(s(n({},{name:"Menus"}),{__name:"index",setup(e){const t=new m({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),l=O(!1),r=O(!1),a=O(),i=O(),o=O(!1),u=O({}),$=O(!1),q={name:"",path:""},z=C(n({},q)),F=C(n({},q)),H=P(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"path",type:"input",props:{clearable:!0}}]);d(()=>{me()});const Q=e=>{var t,l,r;return"button"===e.type?"danger":"menu"===e.type?"primary":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"success":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:X,columns:Y}=c(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return R(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>S(N,{type:Q(e)},()=>(e=>{var t,l,r;return"button"===e.type?"按钮":"folder"===e.type?"目录":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"name",label:"权限标识",formatter:e=>{var t;return(null==(t=e.children)?void 0:t.length)&&e.children.some(e=>{var t;return"button"===(null==(t=e.meta)?void 0:t.menuType)})?`${e.children.length} 个权限标识`:e.name}},{prop:"sort",label:"排序"},{prop:"updateTime",label:"编辑时间",width:180,formatter:e=>D(null==e?void 0:e.updateTime)},{prop:"status",label:"状态",formatter:()=>S(N,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{const t={style:"text-align: right"};return"button"===e.type?S("div",t,[S(G,{type:"edit",permission:"menu:edit",onClick:()=>ne(e)}),S(G,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})]):S("div",t,[S(G,{type:"add",permission:"menu:add",onClick:()=>ie(e),title:"新增权限"}),S(G,{type:"edit",permission:"menu:edit",onClick:()=>oe(e)}),S(G,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})])}}]),J=O([]),ee=()=>{Object.assign(z,n({},q)),Object.assign(F,n({},q)),me()},te=()=>{Object.assign(F,n({},z)),me()},le=()=>{me()},re=P(()=>J.value),ae=()=>{u.value={},$.value=!1,o.value=!0,i.value.handleSetParent({menuTree:J.value})},ie=e=>{u.value={},$.value=!1,i.value.handleSetParent(s(n({},e),{menuTree:J.value})),o.value=!0},oe=e=>{u.value=e,$.value=!0,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},ne=e=>{u.value=e,$.value=!1,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},se=e=>{me()},pe=e=>p(null,null,function*(){var l;try{yield M.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=null==(l=t.getDescendants(J.value,e.id,!0))?void 0:l.map(e=>e.id);yield B({ids:r}),yield me()}catch(r){"cancel"!==r&&I.error("删除失败")}}),ue=()=>{r.value=!r.value,E(()=>{var e;if((null==(e=a.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var l;(null==(l=t.children)?void 0:l.length)&&(a.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})},me=()=>p(null,null,function*(){try{l.value=!0;const{name:e,path:r}=z,a={name:e,path:r},{data:i}=yield v(a);J.value=t.listToTree(i,(e,t)=>e.sort-t.sort)}finally{l.value=!1}});return(e,t)=>{const n=Z,s=A,p=V,m=U,d=K,c=j("auth"),v=j("ripple");return y(),f("div",W,[b(n,{modelValue:h(z),"onUpdate:modelValue":t[0]||(t[0]=e=>_(z)?z.value=e:null),items:h(H),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),b(d,{class:"art-table-card",shadow:"never"},{default:g(()=>[b(p,{showZebra:!1,loading:h(l),columns:h(X),"onUpdate:columns":t[1]||(t[1]=e=>_(X)?X.value=e:null),onRefresh:le},{left:g(()=>[x((y(),k(s,{onClick:ae},{default:g(()=>[...t[3]||(t[3]=[w(" 添加菜单 ",-1)])]),_:1})),[[c,"menu:add"],[v]]),x((y(),k(s,{onClick:ue},{default:g(()=>[w(T(h(r)?"收起":"展开"),1)]),_:1})),[[v]])]),_:1},8,["loading","columns"]),b(m,{ref_key:"tableRef",ref:a,rowKey:"id",loading:h(l),columns:h(Y),data:h(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),b(L,{ref_key:"menuDialogRef",ref:i,visible:h(o),"onUpdate:visible":t[2]||(t[2]=e=>_(o)?o.value=e:null),editData:h(u),lockType:h($),onSubmit:se},null,8,["visible","editData","lockType"])]),_:1})])}}}));export{$ as default};
