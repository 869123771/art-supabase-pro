var e=(e,l,a)=>new Promise((t,s)=>{var n=e=>{try{d(a.next(e))}catch(l){s(l)}},o=e=>{try{d(a.throw(e))}catch(l){s(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,o);d((a=a.apply(e,l)).next())});import{d as l,e3 as a,w as t,b as s,y as n,z as o,H as d,k as u,u as i,f as r,c,j as v,aT as p,i as f,G as h,m as y,p as m,aG as k,ee as g,di as C,ef as _,eg as x}from"./index-DPSTeJg3.js";import{E as K}from"./el-dialog-BWKJgChR.js";import"./el-overlay-CnPdKVNY.js";import{E as b}from"./el-button-C0nCZ2Yb.js";/* empty css                     *//* empty css                *//* empty css                    */import{E as j}from"./index-DSBBASB3.js";import{E as V}from"./index-BuMGoHOk.js";const w={style:{display:"flex","align-items":"center"}},D={key:0},E={key:1},T=l({__name:"role-permission-dialog",props:{modelValue:{type:Boolean,default:!1},roleData:{default:void 0}},emits:["update:modelValue","success"],setup(l,{emit:T}){const H=l,P=T,G=new a({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),I=y(!1),L=y([]),N=y(),z=y(!0),A=y(!1),B=m({get:()=>H.modelValue,set:e=>P("update:modelValue",e)}),M=m(()=>{const e=N.value;if(e)return e.getCheckedKeys()}),O={children:"children",label:e=>{var l;return k(null==(l=e.meta)?void 0:l.title)||e.label||""}};t(()=>H.modelValue,l=>e(null,null,function*(){l&&H.roleData&&(yield J(),yield Q())}));const R=()=>{var e;B.value=!1,null==(e=N.value)||e.setCheckedKeys([])},U=()=>e(null,null,function*(){var e;try{I.value=!0;const l=M.value,a={p_role_id:null==(e=H.roleData)?void 0:e.id,p_menu_ids:l},{error:t}=yield g(a);t||(P("success"),R())}finally{I.value=!1}}),Z=()=>{const e=N.value;if(!e)return;const l=e.store.nodesMap;Object.values(l).forEach(e=>{e.expanded=!z.value}),z.value=!z.value},$=()=>{var e;const l=N.value;if(l){if(A.value)l.setCheckedKeys([]);else{const a=null==(e=G.treeToList(L.value,{includeDepth:!0,includeParentChain:!0}))?void 0:e.map(e=>e.id);l.setCheckedKeys(a)}A.value=!A.value}},q=()=>{var e;const l=M.value,a=null==(e=G.treeToList(L.value,{includeDepth:!0,includeParentChain:!0}))?void 0:e.map(e=>e.id);A.value=l.length===a.length&&a.length>0},F=()=>{const e=N.value;if(!e)return;e.getCheckedKeys(),e.getHalfCheckedKeys(),e.getCheckedNodes(),e.getHalfCheckedNodes();const l=e.getCheckedKeys().length;e.getHalfCheckedKeys().length;C.success(`已输出选中数据到控制台，共选中 ${l} 个节点`)},J=()=>e(null,null,function*(){try{I.value=!0;const{data:e}=yield _();L.value=G.listToTree(e)}finally{I.value=!1}}),Q=()=>e(null,null,function*(){var e,l;try{I.value=!0;const a={id:null==(e=H.roleData)?void 0:e.id},{data:t}=yield x(a);if(t){const e=(t||[]).map(e=>e.menuId);null==(l=N.value)||l.setCheckedKeys(e)}}finally{I.value=!1}});return(e,l)=>{const a=V,t=j,y=b,m=K,k=p;return s(),n(m,{modelValue:i(B),"onUpdate:modelValue":l[0]||(l[0]=e=>h(B)?B.value=e:null),title:"菜单权限",width:"520px","align-center":"",class:"el-dialog-border",onClose:R},{footer:o(()=>[u(y,{onClick:F},{default:o(()=>[...l[1]||(l[1]=[f("获取选中数据",-1)])]),_:1}),u(y,{onClick:Z},{default:o(()=>[f(v(i(z)?"全部收起":"全部展开"),1)]),_:1}),u(y,{onClick:$},{default:o(()=>[f(v(i(A)?"取消全选":"全部选择"),1)]),_:1}),u(y,{type:"primary",onClick:U,loading:i(I)},{default:o(()=>[...l[2]||(l[2]=[f("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[d((s(),n(t,{height:"70vh"},{default:o(()=>[u(a,{ref_key:"treeRef",ref:N,data:i(L),"show-checkbox":"","check-strictly":"","node-key":"id","default-expand-all":i(z),"default-checked-keys":[],props:O,onCheck:q},{default:o(({data:e})=>[r("div",w,[e.isAuth?(s(),c("span",D,v(e.label),1)):(s(),c("span",E,v(O.label(e)),1))])]),_:1},8,["data","default-expand-all"])]),_:1})),[[k,i(I)]])]),_:1},8,["modelValue"])}}});export{T as _};
