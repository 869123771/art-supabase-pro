var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&o(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&o(e,l,t[l]);return e},s=(e,r)=>t(e,l(r)),p=(e,t,l)=>new Promise((r,a)=>{var i=e=>{try{n(l.next(e))}catch(t){a(t)}},o=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,t)).next())});import{d as u,e3 as m,o as d,dm as c,e4 as v,F as j,b as y,c as f,k as h,u as b,G as _,z as g,H as x,y as k,i as w,j as T,m as C,l as O,p as P,n as E,aG as R,a3 as S,e5 as D,e6 as I,di as B}from"./index-DPSTeJg3.js";import{E as K}from"./el-card-D1RdUkmv.js";import{_ as U}from"./index-DbObXW-1.js";import{_ as V}from"./index-BAdF1XEA.js";import{E as G}from"./el-button-C0nCZ2Yb.js";import{_ as $}from"./index-T_xRoqK4.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-BBWZCQUQ.js";import{_ as A}from"./menu-dialog.vue_vue_type_script_setup_true_lang-BgTChCDq.js";import{E as F}from"./overlay-CcLqbF4X.js";/* empty css              */import"./tree-select-CaRCwADZ.js";import{E as H}from"./index-KTnVdGHQ.js";import"./el-empty-CnTNoKsd.js";import"./index-BjhZqp3g.js";import"./el-option-Cu3Wcn2I.js";import"./index-kncddWTf.js";import"./index-CGjb8S7X.js";import"./focus-trap-CfLXOGNm.js";import"./index-DSBBASB3.js";import"./error-D_Dr4eZ1.js";import"./index-D-2gYRbN.js";import"./event-BwRzfsZt.js";import"./use-form-item-Den5WiVg.js";import"./vnode-UiFMCNeh.js";import"./toNumber-BAe7_fgm.js";import"./index-BeNW0q-j.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./_baseClone-D_t03cGa.js";import"./isArrayLikeObject-CZUi8pcQ.js";import"./omit-D87lvzgE.js";import"./debounce-Cvznx2zb.js";import"./index-DBvlfMTq.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css                   */import"./el-dropdown-item-B7ULcKp1.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-Dz1N39RX.js";import"./index-CsP_DisW.js";import"./el-form-item-DCojXG0c.js";import"./el-row-B6xsKG5d.js";import"./el-col-DUQ4hqSh.js";import"./el-radio-CqVR05sK.js";import"./index-waQpsCGt.js";import"./validator-DHzc35r8.js";import"./index-D_s3RTAD.js";import"./el-dialog-BWKJgChR.js";import"./index-D_n3zeho.js";import"./el-overlay-CnPdKVNY.js";import"./index-DIEYZt2K.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-CRb2jdSE.js";import"./isEmpty-DJZs7Cy8.js";import"./cloneDeep-DrmygiZi.js";import"./index-BuMGoHOk.js";import"./index-11QLNccX.js";const W={class:"menu-page art-full-height"},Y=u(s(n({},{name:"Menus"}),{__name:"index",setup(e){const t=new m({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),l=C(!1),r=C(!1),a=C(),i=C(),o=C(!1),u=C({}),Y=C(!1),Z={name:"",path:""},L=O(n({},Z)),M=O(n({},Z)),N=P(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"path",type:"input",props:{clearable:!0}}]);d(()=>{me()});const Q=e=>{var t,l,r;return"button"===e.type?"danger":"menu"===e.type?"primary":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"success":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:X,columns:q}=c(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return R(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>S(H,{type:Q(e)},()=>(e=>{var t,l,r;return"button"===e.type?"按钮":"folder"===e.type?"目录":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"name",label:"权限标识",formatter:e=>{var t;return(null==(t=e.children)?void 0:t.length)&&e.children.some(e=>{var t;return"button"===(null==(t=e.meta)?void 0:t.menuType)})?`${e.children.length} 个权限标识`:e.name}},{prop:"sort",label:"排序"},{prop:"updateTime",label:"编辑时间",width:180,formatter:e=>D(null==e?void 0:e.updateTime)},{prop:"status",label:"状态",formatter:()=>S(H,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{const t={style:"text-align: right"};return"button"===e.type?S("div",t,[S(z,{type:"edit",permission:"menu:edit",onClick:()=>ne(e)}),S(z,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})]):S("div",t,[S(z,{type:"add",permission:"menu:add",onClick:()=>ie(e),title:"新增权限"}),S(z,{type:"edit",permission:"menu:edit",onClick:()=>oe(e)}),S(z,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})])}}]),J=C([]),ee=()=>{Object.assign(L,n({},Z)),Object.assign(M,n({},Z)),me()},te=()=>{Object.assign(M,n({},L)),me()},le=()=>{me()},re=P(()=>J.value),ae=()=>{u.value={},Y.value=!1,o.value=!0,i.value.handleSetParent({menuTree:J.value})},ie=e=>{u.value={},Y.value=!1,i.value.handleSetParent(s(n({},e),{menuTree:J.value})),o.value=!0},oe=e=>{u.value=e,Y.value=!0,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},ne=e=>{u.value=e,Y.value=!1,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},se=e=>{me()},pe=e=>p(null,null,function*(){var l;try{yield F.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=null==(l=t.getDescendants(J.value,e.id,!0))?void 0:l.map(e=>e.id);yield I({ids:r}),yield me()}catch(r){"cancel"!==r&&B.error("删除失败")}}),ue=()=>{r.value=!r.value,E(()=>{var e;if((null==(e=a.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var l;(null==(l=t.children)?void 0:l.length)&&(a.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})},me=()=>p(null,null,function*(){try{l.value=!0;const{name:e,path:r}=L,a={name:e,path:r},{data:i}=yield v(a);J.value=t.listToTree(i,(e,t)=>e.sort-t.sort)}finally{l.value=!1}});return(e,t)=>{const n=$,s=G,p=V,m=U,d=K,c=j("auth"),v=j("ripple");return y(),f("div",W,[h(n,{modelValue:b(L),"onUpdate:modelValue":t[0]||(t[0]=e=>_(L)?L.value=e:null),items:b(N),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),h(d,{class:"art-table-card",shadow:"never"},{default:g(()=>[h(p,{showZebra:!1,loading:b(l),columns:b(X),"onUpdate:columns":t[1]||(t[1]=e=>_(X)?X.value=e:null),onRefresh:le},{left:g(()=>[x((y(),k(s,{onClick:ae},{default:g(()=>[...t[3]||(t[3]=[w(" 添加菜单 ",-1)])]),_:1})),[[c,"menu:add"],[v]]),x((y(),k(s,{onClick:ue},{default:g(()=>[w(T(b(r)?"收起":"展开"),1)]),_:1})),[[v]])]),_:1},8,["loading","columns"]),h(m,{"table-layout":"fixed",ref_key:"tableRef",ref:a,rowKey:"id",loading:b(l),columns:b(q),data:b(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),h(A,{ref_key:"menuDialogRef",ref:i,visible:b(o),"onUpdate:visible":t[2]||(t[2]=e=>_(o)?o.value=e:null),editData:b(u),lockType:b(Y),onSubmit:se},null,8,["visible","editData","lockType"])]),_:1})])}}}));export{Y as default};
