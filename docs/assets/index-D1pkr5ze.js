var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&o(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&o(e,l,t[l]);return e},s=(e,r)=>t(e,l(r)),p=(e,t,l)=>new Promise((r,a)=>{var i=e=>{try{n(l.next(e))}catch(t){a(t)}},o=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,t)).next())});import{d as m,e3 as u,o as d,dm as c,e4 as v,F as j,b as y,c as f,k as h,u as b,G as _,z as g,H as x,y as k,i as w,j as T,m as C,l as O,p as P,n as E,aG as R,a3 as S,e5 as D,e6 as I,di as B}from"./index-DocD4lg6.js";import{E as K}from"./el-card-B06Vnpo2.js";import{_ as U}from"./index-BPQccTEq.js";import{_ as V}from"./index-D4rjkLSJ.js";import{E as G}from"./el-button-D_FpX5vN.js";import{_ as $}from"./index-CVFQuerj.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-CxTQR7cy.js";import{_ as A}from"./menu-dialog.vue_vue_type_script_setup_true_lang-CUUMpy2T.js";import{E as F}from"./overlay-DzZOJsRm.js";/* empty css              */import"./tree-select-ZGjh6-KT.js";import{E as H}from"./index-CiwdMdhb.js";import"./el-empty-BMzqL6V1.js";import"./index-B8YGeOD4.js";import"./el-option-CzZzDyq0.js";import"./index-CXepPrJW.js";import"./index-DmiZVFYU.js";import"./focus-trap-CMJEhiq8.js";import"./index-NP_uivuD.js";import"./error-D_Dr4eZ1.js";import"./index-BQDo0aJw.js";import"./event-BwRzfsZt.js";import"./use-form-item-CYVSqIfx.js";import"./vnode-CSsEsc6D.js";import"./toNumber-CGZZzxeH.js";import"./index-C9voYJJp.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./_baseClone-l1ALzJG5.js";import"./isArrayLikeObject-2PyeHjau.js";import"./omit-Ba47H9Mc.js";import"./debounce-CUa5Mv9U.js";import"./index-CIjb2oSb.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css                   */import"./el-dropdown-item-BV4GnYEc.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-CQ-lFaSs.js";import"./index-CgtpcOQU.js";import"./el-form-item-BATHfeAQ.js";import"./el-row-C6QA-4HM.js";import"./el-col-91Qg2GeF.js";import"./el-radio-BCc0r040.js";import"./index-Tq9wvZAa.js";import"./validator-BtxKqV6u.js";import"./index-mxqHeaJB.js";import"./el-dialog-DlC7JF0o.js";import"./index-BPDxHcTG.js";import"./el-overlay-BFiG6gu6.js";import"./index-jnk7giIE.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-D8QQsF4y.js";import"./isEmpty-B1VGMfBf.js";import"./cloneDeep-DHbxZ_0L.js";import"./index-D8oSONE_.js";import"./index-BchsOKFE.js";const W={class:"menu-page art-full-height"},Y=m(s(n({},{name:"Menus"}),{__name:"index",setup(e){const t=new u({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),l=C(!1),r=C(!1),a=C(),i=C(),o=C(!1),m=C({}),Y=C(!1),Z={name:"",path:""},L=O(n({},Z)),M=O(n({},Z)),N=P(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"path",type:"input",props:{clearable:!0}}]);d(()=>{ue()});const Q=e=>{var t,l,r;return"button"===e.type?"danger":"menu"===e.type?"primary":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"success":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:X,columns:q}=c(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return R(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>S(H,{type:Q(e)},()=>(e=>{var t,l,r;return"button"===e.type?"按钮":"folder"===e.type?"目录":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"name",label:"权限标识",formatter:e=>{var t;return(null==(t=e.children)?void 0:t.length)&&e.children.some(e=>{var t;return"button"===(null==(t=e.meta)?void 0:t.menuType)})?`${e.children.length} 个权限标识`:e.name}},{prop:"sort",label:"排序"},{prop:"updateTime",label:"编辑时间",width:180,formatter:e=>D(null==e?void 0:e.updateTime)},{prop:"status",label:"状态",formatter:()=>S(H,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{const t={style:"text-align: right"};return"button"===e.type?S("div",t,[S(z,{type:"edit",permission:"menu:edit",onClick:()=>ne(e)}),S(z,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})]):S("div",t,[S(z,{type:"add",permission:"menu:add",onClick:()=>ie(e),title:"新增权限"}),S(z,{type:"edit",permission:"menu:edit",onClick:()=>oe(e)}),S(z,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})])}}]),J=C([]),ee=()=>{Object.assign(L,n({},Z)),Object.assign(M,n({},Z)),ue()},te=()=>{Object.assign(M,n({},L)),ue()},le=()=>{ue()},re=P(()=>J.value),ae=()=>{m.value={},Y.value=!1,o.value=!0,i.value.handleSetParent({menuTree:J.value})},ie=e=>{m.value={},Y.value=!1,i.value.handleSetParent(s(n({},e),{menuTree:J.value})),o.value=!0},oe=e=>{m.value=e,Y.value=!0,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},ne=e=>{m.value=e,Y.value=!1,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:J.value}))},se=e=>{ue()},pe=e=>p(null,null,function*(){var l;try{yield F.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=null==(l=t.getDescendants(J.value,e.id,!0))?void 0:l.map(e=>e.id);yield I({ids:r}),yield ue()}catch(r){"cancel"!==r&&B.error("删除失败")}}),me=()=>{r.value=!r.value,E(()=>{var e;if((null==(e=a.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var l;(null==(l=t.children)?void 0:l.length)&&(a.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})},ue=()=>p(null,null,function*(){try{l.value=!0;const{name:e,path:r}=L,a={name:e,path:r},{data:i}=yield v(a);J.value=t.listToTree(i,(e,t)=>e.sort-t.sort)}finally{l.value=!1}});return(e,t)=>{const n=$,s=G,p=V,u=U,d=K,c=j("auth"),v=j("ripple");return y(),f("div",W,[h(n,{modelValue:b(L),"onUpdate:modelValue":t[0]||(t[0]=e=>_(L)?L.value=e:null),items:b(N),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),h(d,{class:"art-table-card",shadow:"never"},{default:g(()=>[h(p,{showZebra:!1,loading:b(l),columns:b(X),"onUpdate:columns":t[1]||(t[1]=e=>_(X)?X.value=e:null),onRefresh:le},{left:g(()=>[x((y(),k(s,{onClick:ae},{default:g(()=>[...t[3]||(t[3]=[w(" 添加菜单 ",-1)])]),_:1})),[[c,"menu:add"],[v]]),x((y(),k(s,{onClick:me},{default:g(()=>[w(T(b(r)?"收起":"展开"),1)]),_:1})),[[v]])]),_:1},8,["loading","columns"]),h(u,{ref_key:"tableRef",ref:a,rowKey:"id",loading:b(l),columns:b(q),data:b(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),h(A,{ref_key:"menuDialogRef",ref:i,visible:b(o),"onUpdate:visible":t[2]||(t[2]=e=>_(o)?o.value=e:null),editData:b(m),lockType:b(Y),onSubmit:se},null,8,["visible","editData","lockType"])]),_:1})])}}}));export{Y as default};
