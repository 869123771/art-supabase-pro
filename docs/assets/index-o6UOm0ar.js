var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,u=(e,l)=>{for(var t in l||(l={}))s.call(l,t)&&o(e,t,l[t]);if(a)for(var t of a(l))r.call(l,t)&&o(e,t,l[t]);return e},n=(e,a)=>l(e,t(a));import{d as i,C as c,x as v,s as d,aL as p,o as f,aK as m,aF as h,n as x,b as g,c as b,k as y,z as w,u as j,ex as k,G as _,f as C,H as E,M as S,N as T,g as O,i as A,j as D,aG as H,a6 as L,aE as M,m as K}from"./index-Dp_GRdij.js";import{E as V}from"./el-dialog-CLVXhprU.js";import"./el-overlay-113k3ltl.js";/* empty css                     *//* empty css                 */import{_ as $}from"./index.vue_vue_type_script_setup_true_lang-DKdW2tza.js";import{E as I}from"./index-6gY0_SfG.js";import{E as P}from"./index-rMHat4bO.js";import{_ as G}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-CjiF4d6W.js";import"./vnode-CYrDy7Zs.js";import"./error-D_Dr4eZ1.js";import"./focus-trap-BuAZGuAO.js";import"./index-CAuLSoBq.js";import"./refs-Cw5r5QN8.js";import"./index-CV23GvbI.js";import"./event-BwRzfsZt.js";import"./index-QUPeURfZ.js";import"./use-form-item-45aK5G8L.js";const U={class:"layout-search"},R={class:"h-4.5 flex-cc rounded border border-g-300 dark:!bg-g-200/50 !bg-box px-1.5 text-g-500"},q={class:"result w-full"},z=["onClick","onMouseenter"],B={class:"text-xs text-g-500"},F={class:"mt-1.5 w-full"},N=["onClick","onMouseenter"],J=["onClick"],Q={class:"dialog-footer box-border flex-c border-t-d pt-4.5 pb-1"},W={class:"flex-cc"},X={class:"mr-3.5 text-xs text-g-700"},Y={class:"flex-c"},Z={class:"mr-3.5 text-xs text-g-700"},ee={class:"flex-c"},le={class:"mr-3.5 text-xs text-g-700"},te=G(i(n(u({},{name:"ArtGlobalSearch"}),{__name:"index",setup(e){const l=c(),t=v(),{menuList:a}=d(p()),s=K(!1),r=K(""),o=K([]),{searchHistory:i}=d(t),G=K(null),te=K(0),ae=K(0),se=K(),re=K(!1);f(()=>{m.on("openSearchDialog",ye),document.addEventListener("keydown",oe)}),h(()=>{document.removeEventListener("keydown",oe)});const oe=e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),s.value=!0,ue()),s.value&&("ArrowUp"===e.key?(e.preventDefault(),ce()):"ArrowDown"===e.key?(e.preventDefault(),ve()):"Enter"===e.key?(e.preventDefault(),fe()):"Escape"===e.key&&(e.preventDefault(),s.value=!1))},ue=()=>{setTimeout(()=>{var e;null==(e=G.value)||e.focus()},100)},ne=e=>{o.value=e?ie(a.value,e):[]},ie=(e,l)=>{const t=l.toLowerCase(),a=[],s=e=>{var l;if(null==(l=e.meta)?void 0:l.isHide)return;const r=H(e.meta.title).toLowerCase();e.children&&e.children.length>0?e.children.forEach(s):r.includes(t)&&e.path&&a.push(n(u({},e),{children:void 0}))};return e.forEach(s),a},ce=()=>{re.value=!0,r.value?(te.value=(te.value-1+o.value.length)%o.value.length,de()):(ae.value=(ae.value-1+i.value.length)%i.value.length,pe()),setTimeout(()=>{re.value=!1},100)},ve=()=>{re.value=!0,r.value?(te.value=(te.value+1)%o.value.length,de()):(ae.value=(ae.value+1)%i.value.length,pe()),setTimeout(()=>{re.value=!1},100)},de=()=>{x(()=>{if(!se.value||!o.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".result .box");if(!l[te.value])return;const t=l[te.value],a=t.offsetHeight,s=e.scrollTop,r=e.clientHeight,u=t.offsetTop,n=u+a;u<s?se.value.setScrollTop(u):n>s+r&&se.value.setScrollTop(n-r)})},pe=()=>{x(()=>{if(!se.value||!i.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".history-result .box");if(!l[ae.value])return;const t=l[ae.value],a=t.offsetHeight,s=e.scrollTop,r=e.clientHeight,o=t.offsetTop,u=o+a;o<s?se.value.setScrollTop(o):u>s+r&&se.value.setScrollTop(u-r)})},fe=()=>{r.value&&o.value.length?xe(o.value[te.value]):!r.value&&i.value.length&&xe(i.value[ae.value])},me=e=>te.value===e,he=()=>{te.value=0},xe=e=>{s.value=!1,be(e),l.push(e.path),r.value="",o.value=[]},ge=()=>{Array.isArray(i.value)&&t.setSearchHistory(i.value)},be=e=>{const l=i.value.findIndex(l=>l.path===e.path);-1!==l?i.value.splice(l,1):i.value.length>=10&&i.value.pop();const t=u({},e);delete t.children,delete t.meta.authList,i.value.unshift(t),ge()},ye=()=>{s.value=!0,ue()},we=()=>{r.value="",o.value=[],te.value=0,ae.value=0};return(e,l)=>{const t=$,a=I,u=P,n=V;return g(),b("div",U,[y(n,{modelValue:j(s),"onUpdate:modelValue":l[1]||(l[1]=e=>_(s)?s.value=e:null),width:"600","show-close":!1,"lock-scroll":!1,"modal-class":"search-modal",onClose:we},{footer:w(()=>[C("div",Q,[C("div",W,[y(t,{icon:"fluent:arrow-enter-left-20-filled",class:"keyboard"}),C("span",X,D(e.$t("search.selectKeydown")),1)]),C("div",Y,[y(t,{icon:"ri:arrow-up-wide-fill",class:"keyboard"}),y(t,{icon:"ri:arrow-down-wide-fill",class:"keyboard"}),C("span",Z,D(e.$t("search.switchKeydown")),1)]),C("div",ee,[l[2]||(l[2]=C("i",{class:"keyboard !w-8 flex-cc"},[C("p",{class:"text-[10px] font-medium"},"ESC")],-1)),C("span",le,D(e.$t("search.exitKeydown")),1)])])]),default:w(()=>[y(a,{modelValue:j(r),"onUpdate:modelValue":l[0]||(l[0]=e=>_(r)?r.value=e:null),modelModifiers:{trim:!0},placeholder:e.$t("search.placeholder"),onInput:ne,onBlur:he,ref_key:"searchInput",ref:G,"prefix-icon":j(k),class:"h-12"},{suffix:w(()=>[C("div",R,[y(t,{icon:"fluent:arrow-enter-left-20-filled"})])]),_:1},8,["modelValue","placeholder","prefix-icon"]),y(u,{class:"mt-5","max-height":"370px",ref_key:"searchResultScrollbar",ref:se,always:""},{default:w(()=>[E(C("div",q,[(g(!0),b(S,null,T(j(o),(e,l)=>(g(),b("div",{class:"box !mt-0 c-p text-base leading-none",key:l},[C("div",{class:O(["mt-2 h-12 flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-700",me(l)?"highlighted !bg-theme/70 !text-white":""]),onClick:l=>xe(e),onMouseenter:e=>(e=>{!re.value&&r.value&&(te.value=e)})(l)},[A(D(j(H)(e.meta.title))+" ",1),E(y(t,{icon:"fluent:arrow-enter-left-20-filled"},null,512),[[L,me(l)]])],42,z)]))),128))],512),[[L,j(o).length]]),E(C("div",null,[C("p",B,D(e.$t("search.historyTitle")),1),C("div",F,[(g(!0),b(S,null,T(j(i),(e,l)=>(g(),b("div",{class:O(["box mt-2 h-12 c-p flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-800",j(ae)===l?"highlighted !bg-theme/70 !text-white [&_.selected-icon]:!text-white":""]),key:l,onClick:l=>xe(e),onMouseenter:e=>(e=>{re.value||r.value||(ae.value=e)})(l)},[A(D(j(H)(e.meta.title))+" ",1),C("div",{class:"size-5 selected-icon select-none rounded-full text-g-500 flex-cc c-p",onClick:M(e=>(e=>{i.value.splice(e,1),ge()})(l),["stop"])},[y(t,{icon:"ri:close-large-fill",class:"text-xs"})],8,J)],42,N))),128))])],512),[[L,!j(r)&&0===j(o).length&&j(i).length>0]])]),_:1},512)]),_:1},8,["modelValue"])])}}})),[["__scopeId","data-v-6afb5139"]]);export{te as default};
