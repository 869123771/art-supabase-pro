var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&o(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&o(e,l,t[l]);return e},s=(e,r)=>t(e,l(r)),p=(e,t,l)=>new Promise((r,a)=>{var i=e=>{try{n(l.next(e))}catch(t){a(t)}},o=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,t)).next())});import{d as u,bi as m,a as d,r as c,c as v,o as j,bj as y,bk as f,F as h,e as b,f as _,p as g,u as x,G as k,z as w,H as O,y as T,l as C,m as P,n as E,aG as R,bl as S,a8 as D,bm as K,a_ as I}from"./index-UHpcR4FB.js";import{E as U}from"./el-card-DagT15Zb.js";import{_ as V}from"./index-C8GqX7Z_.js";import{_ as A}from"./index-92aSGzBj.js";import{E as B}from"./el-button-Dq6xFC1X.js";import{_ as F}from"./index-RAzvJI3w.js";import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-BALVg517.js";import{_ as L}from"./menu-dialog.vue_vue_type_script_setup_true_lang-BbJ2Gobn.js";import{E as M}from"./overlay-DFXMKnUr.js";/* empty css              */import"./tree-select-QekashSX.js";import{E as z}from"./el-option-14m9u58y.js";import"./el-empty-B9y5K022.js";import"./index-CZuR-eJU.js";import"./index-DsVoTwVl.js";import"./index-C5rzeD65.js";import"./event-BwRzfsZt.js";import"./index-J2a0qSc0.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./index-CJhUgKsi.js";import"./index-Cv9HC74p.js";import"./_initCloneObject-Bu1jJE8X.js";import"./isArrayLikeObject-4YSmOE5u.js";import"./isPlainObject-C_RzBeUy.js";import"./index-DwkhIZLG.js";import"./index-BlWSUxQD.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css                   */import"./el-dropdown-item-DAB1AFNA.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-2vhUVHQy.js";import"./index-AopiPaZg.js";import"./el-form-item-DKSvuzPo.js";import"./el-row-DEWeIaDX.js";import"./el-col-BWCC-GEt.js";import"./el-radio-CMZksyk5.js";import"./index-CUYNHlXJ.js";import"./validator-DgeUgi_j.js";import"./index-DqeNmu5H.js";import"./el-dialog-DMlvGgU3.js";import"./index-CTZaX8i3.js";import"./vnode-CwxfhvFG.js";import"./el-overlay-CLnjAPI7.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-Cl3sZWJc.js";import"./isEmpty--QoX21K3.js";import"./cloneDeep-Da4gXPlP.js";import"./index-CbPK0kml.js";import"./token-DWNpOE8r.js";import"./index-Dwiiarok.js";const H={class:"menu-page art-full-height"},J=u(s(n({},{name:"Menus"}),{__name:"index",setup(e){const t=new m({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),l=d(!1),r=d(!1),a=d(),i=d(),o=d(!1),u=d({}),J=d(!1),N={name:"",path:""},W=c(n({},N)),Z=c(n({},N)),q=v(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"path",type:"input",props:{clearable:!0}}]);j(()=>{me()});const Q=e=>{var t,l,r;return"button"===e.type?"danger":"menu"===e.type?"primary":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"success":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:X,columns:$}=y(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return R(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>D(z,{type:Q(e)},()=>(e=>{var t,l,r;return"button"===e.type?"按钮":"folder"===e.type?"目录":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"name",label:"权限标识",formatter:e=>{var t;return(null==(t=e.children)?void 0:t.length)&&e.children.some(e=>{var t;return"button"===(null==(t=e.meta)?void 0:t.menuType)})?`${e.children.length} 个权限标识`:e.name}},{prop:"sort",label:"排序"},{prop:"updateTime",label:"编辑时间",width:180,formatter:e=>S(null==e?void 0:e.updateTime)},{prop:"status",label:"状态",formatter:()=>D(z,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{const t={style:"text-align: right"};return"button"===e.type?D("div",t,[D(G,{type:"edit",permission:"menu:edit",onClick:()=>ne(e)}),D(G,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})]):D("div",t,[D(G,{type:"add",permission:"menu:add",onClick:()=>ie(e),title:"新增权限"}),D(G,{type:"edit",permission:"menu:edit",onClick:()=>oe(e)}),D(G,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})])}}]),Y=d([]),ee=()=>{Object.assign(W,n({},N)),Object.assign(Z,n({},N)),me()},te=()=>{Object.assign(Z,n({},W)),me()},le=()=>{me()},re=v(()=>Y.value),ae=()=>{u.value={},J.value=!1,o.value=!0,i.value.handleSetParent({menuTree:Y.value})},ie=e=>{u.value={},J.value=!1,i.value.handleSetParent(s(n({},e),{menuTree:Y.value})),o.value=!0},oe=e=>{u.value=e,J.value=!0,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:Y.value}))},ne=e=>{u.value=e,J.value=!1,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:Y.value}))},se=e=>{me()},pe=e=>p(null,null,function*(){var l;try{yield M.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=null==(l=t.getDescendants(Y.value,e.id,!0))?void 0:l.map(e=>e.id);yield K({ids:r}),yield me()}catch(r){"cancel"!==r&&I.error("删除失败")}}),ue=()=>{r.value=!r.value,E(()=>{var e;if((null==(e=a.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var l;(null==(l=t.children)?void 0:l.length)&&(a.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})},me=()=>p(null,null,function*(){try{l.value=!0;const{name:e,path:r}=W,a={name:e,path:r},{data:i}=yield f(a);Y.value=t.listToTree(i,(e,t)=>e.sort-t.sort)}finally{l.value=!1}});return(e,t)=>{const n=F,s=B,p=A,m=V,d=U,c=h("auth"),v=h("ripple");return _(),b("div",H,[g(n,{modelValue:x(W),"onUpdate:modelValue":t[0]||(t[0]=e=>k(W)?W.value=e:null),items:x(q),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),g(d,{class:"art-table-card",shadow:"never"},{default:w(()=>[g(p,{showZebra:!1,loading:x(l),columns:x(X),"onUpdate:columns":t[1]||(t[1]=e=>k(X)?X.value=e:null),onRefresh:le},{left:w(()=>[O((_(),T(s,{onClick:ae},{default:w(()=>[...t[3]||(t[3]=[C(" 添加菜单 ",-1)])]),_:1})),[[c,"menu:add"],[v]]),O((_(),T(s,{onClick:ue},{default:w(()=>[C(P(x(r)?"收起":"展开"),1)]),_:1})),[[v]])]),_:1},8,["loading","columns"]),g(m,{ref_key:"tableRef",ref:a,rowKey:"id",loading:x(l),columns:x($),data:x(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),g(L,{ref_key:"menuDialogRef",ref:i,visible:x(o),"onUpdate:visible":t[2]||(t[2]=e=>k(o)?o.value=e:null),editData:x(u),lockType:x(J),onSubmit:se},null,8,["visible","editData","lockType"])]),_:1})])}}}));export{J as default};
