var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,l,r)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,n=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&o(e,l,t[l]);if(r)for(var l of r(t))i.call(t,l)&&o(e,l,t[l]);return e},s=(e,r)=>t(e,l(r)),p=(e,t,l)=>new Promise((r,a)=>{var i=e=>{try{n(l.next(e))}catch(t){a(t)}},o=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((l=l.apply(e,t)).next())});import{d as u,bi as m,a as d,r as c,c as v,o as j,bj as y,bk as f,F as b,e as h,f as _,p as g,u as x,G as k,z as w,H as O,y as T,l as P,m as C,n as E,aG as S,bl as R,a8 as D,bm as K,a_ as U}from"./index-CSMnfbno.js";import{E as B}from"./el-card-B6Ia56f-.js";import{_ as G}from"./index-De5Bv7MU.js";import{_ as I}from"./index-DYfyL518.js";import{E as A}from"./el-button-D6QoVWRW.js";import{_ as F}from"./index-DyilxQCC.js";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-BdX-2qTV.js";import{_ as M}from"./menu-dialog.vue_vue_type_script_setup_true_lang-DA7RGtxA.js";import{E as V}from"./overlay-B8r24MVu.js";/* empty css              */import"./tree-select-CKlPWme6.js";import{E as H}from"./el-option-BCrjfraG.js";import"./el-empty-CnCXwl8a.js";import"./index-Cb-YqCnn.js";import"./index-C8WLZA2V.js";import"./index-BdYr8bnS.js";import"./event-BwRzfsZt.js";import"./index-BQLgPbRy.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    *//* empty css                   */import"./index-CPbiEs8c.js";import"./index-DuKNL8KD.js";import"./_initCloneObject-D_J0kv5r.js";import"./isArrayLikeObject-BHHvWoZq.js";import"./isPlainObject-BXtvNV_I.js";import"./debounce-BJI_62rc.js";import"./index-CewyASu6.js";import"./index-Du7uvaPu.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";/* empty css                   */import"./el-dropdown-item-CnpNiUFX.js";import"./refs-Cw5r5QN8.js";import"./index.vue_vue_type_script_setup_true_lang-iXCyht8V.js";import"./index-D2GK6m-k.js";import"./el-form-item-BLLKL5R4.js";import"./el-row-DRHHaM04.js";import"./el-col-Do1j6w50.js";import"./el-radio-SyfcilD8.js";import"./index-DNVaB9JF.js";import"./validator-CagHWFVr.js";import"./index-B3mgwR5p.js";import"./el-dialog-D_Pkvt-7.js";import"./index-C3twjQDk.js";import"./vnode-ouMtHBV5.js";import"./el-overlay-ZKdz0fk-.js";/* empty css                        */import"./index.vue_vue_type_script_setup_true_lang-Z9YAU5D6.js";import"./isEmpty-BH9Ay-Eb.js";import"./cloneDeep-DYvNsBPA.js";import"./index-CUC2Yo4j.js";import"./token-DWNpOE8r.js";import"./index-BHBr2Xik.js";const N={class:"menu-page art-full-height"},W=u(s(n({},{name:"Menus"}),{__name:"index",setup(e){const t=new m({idKey:"id",parentKey:"parentId",childrenKey:"children",deepClone:!0}),l=d(!1),r=d(!1),a=d(),i=d(),o=d(!1),u=d({}),W=d(!1),X={name:"",path:""},q=c(n({},X)),z=c(n({},X)),J=v(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"path",type:"input",props:{clearable:!0}}]);j(()=>{me()});const Q=e=>{var t,l,r;return"button"===e.type?"danger":"menu"===e.type?"primary":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"success":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:Z,columns:$}=y(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return S(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>D(H,{type:Q(e)},()=>(e=>{var t,l,r;return"button"===e.type?"按钮":"folder"===e.type?"目录":(null==(t=e.meta)?void 0:t.link)&&(null==(l=e.meta)?void 0:l.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,l;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(l=e.meta)?void 0:l.link)||e.path||""}},{prop:"name",label:"权限标识",formatter:e=>{var t;return(null==(t=e.children)?void 0:t.length)&&e.children.some(e=>{var t;return"button"===(null==(t=e.meta)?void 0:t.menuType)})?`${e.children.length} 个权限标识`:e.name}},{prop:"sort",label:"排序"},{prop:"updateTime",label:"编辑时间",width:180,formatter:e=>R(null==e?void 0:e.updateTime)},{prop:"status",label:"状态",formatter:()=>D(H,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{const t={style:"text-align: right"};return"button"===e.type?D("div",t,[D(L,{type:"edit",permission:"menu:edit",onClick:()=>ne(e)}),D(L,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})]):D("div",t,[D(L,{type:"add",permission:"menu:add",onClick:()=>ie(e),title:"新增权限"}),D(L,{type:"edit",permission:"menu:edit",onClick:()=>oe(e)}),D(L,{type:"delete",permission:"menu:delete",onClick:()=>pe(e)})])}}]),Y=d([]),ee=()=>{Object.assign(q,n({},X)),Object.assign(z,n({},X)),me()},te=()=>{Object.assign(z,n({},q)),me()},le=()=>{me()},re=v(()=>Y.value),ae=()=>{u.value={},W.value=!1,o.value=!0,i.value.handleSetParent({menuTree:Y.value})},ie=e=>{u.value={},W.value=!1,i.value.handleSetParent(s(n({},e),{menuTree:Y.value})),o.value=!0},oe=e=>{u.value=e,W.value=!0,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:Y.value}))},ne=e=>{u.value=e,W.value=!1,o.value=!0,i.value.handleSetParent(s(n({},e),{menuTree:Y.value}))},se=e=>{me()},pe=e=>p(null,null,function*(){var l;try{yield V.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=null==(l=t.getDescendants(Y.value,e.id,!0))?void 0:l.map(e=>e.id);yield K({ids:r}),yield me()}catch(r){"cancel"!==r&&U.error("删除失败")}}),ue=()=>{r.value=!r.value,E(()=>{var e;if((null==(e=a.value)?void 0:e.elTableRef)&&re.value){const e=t=>{t.forEach(t=>{var l;(null==(l=t.children)?void 0:l.length)&&(a.value.elTableRef.toggleRowExpansion(t,r.value),e(t.children))})};e(re.value)}})},me=()=>p(null,null,function*(){try{l.value=!0;const{name:e,path:r}=q,a={name:e,path:r},{data:i}=yield f(a);Y.value=t.listToTree(i,(e,t)=>e.sort-t.sort)}finally{l.value=!1}});return(e,t)=>{const n=F,s=A,p=I,m=G,d=B,c=b("auth"),v=b("ripple");return _(),h("div",N,[g(n,{modelValue:x(q),"onUpdate:modelValue":t[0]||(t[0]=e=>k(q)?q.value=e:null),items:x(J),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),g(d,{class:"art-table-card",shadow:"never"},{default:w(()=>[g(p,{showZebra:!1,loading:x(l),columns:x(Z),"onUpdate:columns":t[1]||(t[1]=e=>k(Z)?Z.value=e:null),onRefresh:le},{left:w(()=>[O((_(),T(s,{onClick:ae},{default:w(()=>[...t[3]||(t[3]=[P(" 添加菜单 ",-1)])]),_:1})),[[c,"menu:add"],[v]]),O((_(),T(s,{onClick:ue},{default:w(()=>[P(C(x(r)?"收起":"展开"),1)]),_:1})),[[v]])]),_:1},8,["loading","columns"]),g(m,{ref_key:"tableRef",ref:a,rowKey:"id",loading:x(l),columns:x($),data:x(re),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),g(M,{ref_key:"menuDialogRef",ref:i,visible:x(o),"onUpdate:visible":t[2]||(t[2]=e=>k(o)?o.value=e:null),editData:x(u),lockType:x(W),onSubmit:se},null,8,["visible","editData","lockType"])]),_:1})])}}}));export{W as default};
