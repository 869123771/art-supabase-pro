var e=Object.defineProperty,l=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,u=(e,l)=>{for(var t in l||(l={}))s.call(l,t)&&r(e,t,l[t]);if(a)for(var t of a(l))o.call(l,t)&&r(e,t,l[t]);return e},n=(e,a)=>l(e,t(a));import{d as i,C as c,x as v,s as d,aL as p,a as f,o as h,aK as m,aF as x,n as g,e as b,f as y,p as w,z as k,u as j,ef as _,G as C,h as S,H as T,M as E,N as O,i as H,l as L,m as A,aG as D,ab as M,aE as K}from"./index-CSMnfbno.js";import{E as V}from"./el-dialog-D_Pkvt-7.js";import"./el-overlay-ZKdz0fk-.js";/* empty css                     *//* empty css                 */import{_ as I}from"./index.vue_vue_type_script_setup_true_lang-iXCyht8V.js";import{E as P}from"./index-C8WLZA2V.js";import{E as U}from"./index-CPbiEs8c.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-C3twjQDk.js";import"./vnode-ouMtHBV5.js";import"./index-BdYr8bnS.js";import"./index-BQLgPbRy.js";import"./refs-Cw5r5QN8.js";import"./index-Cb-YqCnn.js";import"./event-BwRzfsZt.js";const G={class:"layout-search"},R={class:"h-4.5 flex-cc rounded border border-g-300 dark:!bg-g-200/50 !bg-box px-1.5 text-g-500"},q={class:"result w-full"},z=["onClick","onMouseenter"],F={class:"text-xs text-g-500"},B={class:"mt-1.5 w-full"},J=["onClick","onMouseenter"],N=["onClick"],Q={class:"dialog-footer box-border flex-c border-t-d pt-4.5 pb-1"},X={class:"flex-cc"},W={class:"mr-3.5 text-xs text-g-700"},Y={class:"flex-c"},Z={class:"mr-3.5 text-xs text-g-700"},ee={class:"flex-c"},le={class:"mr-3.5 text-xs text-g-700"},te=$(i(n(u({},{name:"ArtGlobalSearch"}),{__name:"index",setup(e){const l=c(),t=v(),{menuList:a}=d(p()),s=f(!1),o=f(""),r=f([]),{searchHistory:i}=d(t),$=f(null),te=f(0),ae=f(0),se=f(),oe=f(!1);h(()=>{m.on("openSearchDialog",ye),document.addEventListener("keydown",re)}),x(()=>{document.removeEventListener("keydown",re)});const re=e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),s.value=!0,ue()),s.value&&("ArrowUp"===e.key?(e.preventDefault(),ce()):"ArrowDown"===e.key?(e.preventDefault(),ve()):"Enter"===e.key?(e.preventDefault(),fe()):"Escape"===e.key&&(e.preventDefault(),s.value=!1))},ue=()=>{setTimeout(()=>{var e;null==(e=$.value)||e.focus()},100)},ne=e=>{r.value=e?ie(a.value,e):[]},ie=(e,l)=>{const t=l.toLowerCase(),a=[],s=e=>{var l;if(null==(l=e.meta)?void 0:l.isHide)return;const o=D(e.meta.title).toLowerCase();e.children&&e.children.length>0?e.children.forEach(s):o.includes(t)&&e.path&&a.push(n(u({},e),{children:void 0}))};return e.forEach(s),a},ce=()=>{oe.value=!0,o.value?(te.value=(te.value-1+r.value.length)%r.value.length,de()):(ae.value=(ae.value-1+i.value.length)%i.value.length,pe()),setTimeout(()=>{oe.value=!1},100)},ve=()=>{oe.value=!0,o.value?(te.value=(te.value+1)%r.value.length,de()):(ae.value=(ae.value+1)%i.value.length,pe()),setTimeout(()=>{oe.value=!1},100)},de=()=>{g(()=>{if(!se.value||!r.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".result .box");if(!l[te.value])return;const t=l[te.value],a=t.offsetHeight,s=e.scrollTop,o=e.clientHeight,u=t.offsetTop,n=u+a;u<s?se.value.setScrollTop(u):n>s+o&&se.value.setScrollTop(n-o)})},pe=()=>{g(()=>{if(!se.value||!i.value.length)return;const e=se.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".history-result .box");if(!l[ae.value])return;const t=l[ae.value],a=t.offsetHeight,s=e.scrollTop,o=e.clientHeight,r=t.offsetTop,u=r+a;r<s?se.value.setScrollTop(r):u>s+o&&se.value.setScrollTop(u-o)})},fe=()=>{o.value&&r.value.length?xe(r.value[te.value]):!o.value&&i.value.length&&xe(i.value[ae.value])},he=e=>te.value===e,me=()=>{te.value=0},xe=e=>{s.value=!1,be(e),l.push(e.path),o.value="",r.value=[]},ge=()=>{Array.isArray(i.value)&&t.setSearchHistory(i.value)},be=e=>{const l=i.value.findIndex(l=>l.path===e.path);-1!==l?i.value.splice(l,1):i.value.length>=10&&i.value.pop();const t=u({},e);delete t.children,delete t.meta.authList,i.value.unshift(t),ge()},ye=()=>{s.value=!0,ue()},we=()=>{o.value="",r.value=[],te.value=0,ae.value=0};return(e,l)=>{const t=I,a=P,u=U,n=V;return y(),b("div",G,[w(n,{modelValue:j(s),"onUpdate:modelValue":l[1]||(l[1]=e=>C(s)?s.value=e:null),width:"600","show-close":!1,"lock-scroll":!1,"modal-class":"search-modal",onClose:we},{footer:k(()=>[S("div",Q,[S("div",X,[w(t,{icon:"fluent:arrow-enter-left-20-filled",class:"keyboard"}),S("span",W,A(e.$t("search.selectKeydown")),1)]),S("div",Y,[w(t,{icon:"ri:arrow-up-wide-fill",class:"keyboard"}),w(t,{icon:"ri:arrow-down-wide-fill",class:"keyboard"}),S("span",Z,A(e.$t("search.switchKeydown")),1)]),S("div",ee,[l[2]||(l[2]=S("i",{class:"keyboard !w-8 flex-cc"},[S("p",{class:"text-[10px] font-medium"},"ESC")],-1)),S("span",le,A(e.$t("search.exitKeydown")),1)])])]),default:k(()=>[w(a,{modelValue:j(o),"onUpdate:modelValue":l[0]||(l[0]=e=>C(o)?o.value=e:null),modelModifiers:{trim:!0},placeholder:e.$t("search.placeholder"),onInput:ne,onBlur:me,ref_key:"searchInput",ref:$,"prefix-icon":j(_),class:"h-12"},{suffix:k(()=>[S("div",R,[w(t,{icon:"fluent:arrow-enter-left-20-filled"})])]),_:1},8,["modelValue","placeholder","prefix-icon"]),w(u,{class:"mt-5","max-height":"370px",ref_key:"searchResultScrollbar",ref:se,always:""},{default:k(()=>[T(S("div",q,[(y(!0),b(E,null,O(j(r),(e,l)=>(y(),b("div",{class:"box !mt-0 c-p text-base leading-none",key:l},[S("div",{class:H(["mt-2 h-12 flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-700",he(l)?"highlighted !bg-theme/70 !text-white":""]),onClick:l=>xe(e),onMouseenter:e=>(e=>{!oe.value&&o.value&&(te.value=e)})(l)},[L(A(j(D)(e.meta.title))+" ",1),T(w(t,{icon:"fluent:arrow-enter-left-20-filled"},null,512),[[M,he(l)]])],42,z)]))),128))],512),[[M,j(r).length]]),T(S("div",null,[S("p",F,A(e.$t("search.historyTitle")),1),S("div",B,[(y(!0),b(E,null,O(j(i),(e,l)=>(y(),b("div",{class:H(["box mt-2 h-12 c-p flex-cb rounded-custom-sm bg-g-200/80 px-4 text-sm text-g-800",j(ae)===l?"highlighted !bg-theme/70 !text-white [&_.selected-icon]:!text-white":""]),key:l,onClick:l=>xe(e),onMouseenter:e=>(e=>{oe.value||o.value||(ae.value=e)})(l)},[L(A(j(D)(e.meta.title))+" ",1),S("div",{class:"size-5 selected-icon select-none rounded-full text-g-500 flex-cc c-p",onClick:K(e=>(e=>{i.value.splice(e,1),ge()})(l),["stop"])},[w(t,{icon:"ri:close-large-fill",class:"text-xs"})],8,N)],42,J))),128))])],512),[[M,!j(o)&&0===j(r).length&&j(i).length>0]])]),_:1},512)]),_:1},8,["modelValue"])])}}})),[["__scopeId","data-v-6afb5139"]]);export{te as default};
