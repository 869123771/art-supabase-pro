var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,u=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))r.call(t,n)&&l(e,n,t[n]);return e},s=(e,a)=>t(e,n(a));import{a9 as i,ab as f,ai as c,_ as d,d as v,o as p,w as m,a as g,cW as h,b as x,c as b,r as y,e as w,aC as $,m as A,p as B,ae as M,ao as k,A as I,q as z,s as S,u as E,k as O,z as P,f as j,h as N}from"./index-DocD4lg6.js";const _=i({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:f([String,Array]),default:"Element Plus"},font:{type:f(Object)},gap:{type:f(Array),default:()=>[100,100]},offset:{type:f(Array)}});const T={left:[0,.5],start:[0,.5],center:[.5,0],right:[1,-.5],end:[1,-.5]};function C(e,t,n=1){const a=document.createElement("canvas"),o=a.getContext("2d"),r=e*n,l=t*n;return a.setAttribute("width",`${r}px`),a.setAttribute("height",`${l}px`),o.save(),[o,a,r,l]}function W(){return function(e,t,n,a,o,r,l,u,s){const[i,f,d,v]=C(a,o,n);let p=0;if(e instanceof HTMLImageElement)i.drawImage(e,0,0,d,v);else{const{color:t,fontSize:a,fontStyle:l,fontWeight:u,fontFamily:f,textAlign:v,textBaseline:m}=r,g=Number(a)*n;i.font=`${l} normal ${u} ${g}px/${o}px ${f}`,i.fillStyle=t,i.textAlign=v,i.textBaseline=m;const h=c(e)?e:[e];if("top"!==m&&h[0]){const e=i.measureText(h[0]);i.textBaseline="top";const t=i.measureText(h[0]);p=e.actualBoundingBoxAscent-t.actualBoundingBoxAscent}null==h||h.forEach((e,t)=>{const[a,o]=T[v];i.fillText(null!=e?e:"",d*a+s*o,t*(g+r.fontGap*n))})}const m=Math.PI/180*Number(t),g=Math.max(a,o),[h,x,b]=C(g,g,n);h.translate(b/2,b/2),h.rotate(m),d>0&&v>0&&h.drawImage(f,-d/2,-v/2);let y=0,w=0,$=0,A=0;const B=d/2,M=v/2;[[0-B,0-M],[0+B,0-M],[0+B,0+M],[0-B,0+M]].forEach(([e,t])=>{const[n,a]=function(e,t){return[e*Math.cos(m)-t*Math.sin(m),e*Math.sin(m)+t*Math.cos(m)]}(e,t);y=Math.min(y,n),w=Math.max(w,n),$=Math.min($,a),A=Math.max(A,a)});const k=y+b/2,I=$+b/2,z=w-y,S=A-$,E=l*n,O=u*n,P=2*(z+E),j=S+O,[N,_]=C(P,j);function W(e=0,t=0){N.drawImage(x,k,I,z,S,e,t+p,z,S)}return W(),W(z+E,-S/2-O/2),W(z+E,+S/2+O/2),[_.toDataURL(),P/n,j/n]}}const D=k(d(v(s(u({},{name:"ElWatermark"}),{__name:"watermark",props:_,setup(e){const t={position:"relative"},n=e,a=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.fontGap)?t:3}),o=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.color)?t:"rgba(0,0,0,.15)"}),r=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.fontSize)?t:16}),l=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.fontWeight)?t:"normal"}),i=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.fontStyle)?t:"normal"}),f=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.fontFamily)?t:"sans-serif"}),d=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.textAlign)?t:"center"}),v=B(()=>{var e,t;return null!=(t=null==(e=n.font)?void 0:e.textBaseline)?t:"hanging"}),k=B(()=>n.gap[0]),I=B(()=>n.gap[1]),z=B(()=>k.value/2),S=B(()=>I.value/2),E=B(()=>{var e,t;return null!=(t=null==(e=n.offset)?void 0:e[0])?t:z.value}),O=B(()=>{var e,t;return null!=(t=null==(e=n.offset)?void 0:e[1])?t:S.value}),P=$(null),j=$(),N=A(!1),_=()=>{j.value&&(j.value.remove(),j.value=void 0)},T=(e,t)=>{var a;P.value&&j.value&&(N.value=!0,j.value.setAttribute("style",function(e){return Object.keys(e).map(t=>`${function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}(t)}: ${e[t]};`).join(" ")}(s(u({},(()=>{const e={zIndex:n.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let t=E.value-z.value,a=O.value-S.value;return t>0&&(e.left=`${t}px`,e.width=`calc(100% - ${t}px)`,t=0),a>0&&(e.top=`${a}px`,e.height=`calc(100% - ${a}px)`,a=0),e.backgroundPosition=`${t}px ${a}px`,e})()),{backgroundImage:`url('${e}')`,backgroundSize:`${Math.floor(t)}px`}))),null==(a=P.value)||a.append(j.value),setTimeout(()=>{N.value=!1}))},C=W(),D=()=>{const e=document.createElement("canvas").getContext("2d"),t=n.image,u=n.content,s=n.rotate;if(e){j.value||(j.value=document.createElement("div"));const p=window.devicePixelRatio||1,[m,g,h]=(e=>{let t=120,o=64,l=0;const{image:u,content:s,width:i,height:d,rotate:v}=n;if(!u&&e.measureText){e.font=`${Number(r.value)}px ${f.value}`;const n=c(s)?s:[s];let u=0,i=0;n.forEach(t=>{const{width:n,fontBoundingBoxAscent:a,fontBoundingBoxDescent:o,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l}=e.measureText(t),s=M(a)?r+l:a+o;n>u&&(u=Math.ceil(n)),s>i&&(i=Math.ceil(s))}),t=u,o=i*n.length+(n.length-1)*a.value;const d=Math.PI/180*Number(v);l=Math.ceil(Math.abs(Math.sin(d)*o)/2),t+=l}return[null!=i?i:t,null!=d?d:o,l]})(e),x=e=>{const[t,n]=C(e||"",s,p,m,g,{color:o.value,fontSize:r.value,fontStyle:i.value,fontWeight:l.value,fontFamily:f.value,fontGap:a.value,textAlign:d.value,textBaseline:v.value},k.value,I.value,h);T(t,n)};if(t){const e=new Image;e.onload=()=>{x(e)},e.onerror=()=>{x(u)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=t}else x(u)}};p(()=>{D()}),m(()=>n,()=>{D()},{deep:!0,flush:"post"}),g(()=>{_()});return h(P,e=>{N.value||e.forEach(e=>{((e,t)=>{let n=!1;return e.removedNodes.length&&t&&(n=Array.from(e.removedNodes).includes(t)),"attributes"===e.type&&e.target===t&&(n=!0),n})(e,j.value)&&(_(),D())})},{attributes:!0,subtree:!0,childList:!0}),(e,n)=>(x(),b("div",{ref_key:"containerRef",ref:P,style:w([t])},[y(e.$slots,"default")],4))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/watermark/src/watermark.vue"]])),L=v(s(u({},{name:"ArtWatermark"}),{__name:"index",props:{content:{default:I.systemInfo.name},visible:{type:Boolean,default:!1},fontSize:{default:16},fontColor:{default:"rgba(128, 128, 128, 0.2)"},rotate:{default:-22},gapX:{default:100},gapY:{default:100},offsetX:{default:50},offsetY:{default:50},zIndex:{default:3100}},setup(e){const t=z(),{watermarkVisible:n}=S(t);return(t,a)=>{const o=D;return E(n)?(x(),b("div",{key:0,class:"fixed left-0 top-0 h-screen w-screen pointer-events-none",style:w({zIndex:e.zIndex})},[O(o,{content:e.content,font:{fontSize:e.fontSize,color:e.fontColor},rotate:e.rotate,gap:[e.gapX,e.gapY],offset:[e.offsetX,e.offsetY]},{default:P(()=>[...a[0]||(a[0]=[j("div",{style:{height:"100vh"}},null,-1)])]),_:1},8,["content","font","rotate","gap","offset"])],4)):N("",!0)}}}));export{L as default};
